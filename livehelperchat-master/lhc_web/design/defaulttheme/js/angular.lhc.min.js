$(document).ready(function(){var t=window.location.hash;""!=t&&$('ul[role="tablist"] a[href="'+t.replace("#/","#")+'"]').tab("show")});var phonecatApp=angular.module("lhcApp",["lhcAppServices","lhcAppControllers"]),services=angular.module("lhcAppServices",[]),lhcAppControllers=angular.module("lhcAppControllers",["checklist-model"]);angular.element(document).ready(function(){var t=angular.element(document.querySelector("form"));t.triggerHandler("$destroy")}),services.factory("LiveHelperChatFactory",["$http","$q",function(t,e){return this.loadChatList=function(i){var a=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/syncadmininterface"+i).success(function(t){"undefined"!=typeof t.error_url?document.location=t.error_url:a.resolve(t)}).error(function(){a.reject("error")}),a.promise},this.loadInitialData=function(){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/loadinitialdata").success(function(t){"undefined"!=typeof t.error_url?document.location=t.error_url:i.resolve(t)}).error(function(){i.reject("error")}),i.promise},this.truncate=function(t,e,i){return isNaN(e)&&(e=10),void 0===i&&(i="..."),t.length<=e||t.length-i.length<=e?t:String(t).substring(0,e-i.length)+i},this}]),lhcAppControllers.controller("LiveHelperChatCtrl",["$scope","$http","$location","$rootScope","$log","$interval","LiveHelperChatFactory",function(t,e,i,a,n,o,s){t.predicate="last_visit",t.pending_chats={},t.pending_chats_expanded=!0,t.active_chats={},t.active_chats_expanded=!0,t.my_active_chats_expanded=!0,t.closed_chats={},t.closed_chats_expanded=!0,t.unread_chats={},t.unread_chats_expanded=!0,t.transfer_dep_chats={},t.transfer_chats={},t.timeoutControl=null,t.setTimeoutEnabled=!0,t.lmtoggle=!1,t.custom_list_1_expanded=!0,t.custom_list_2_expanded=!0,t.custom_list_3_expanded=!0,t.custom_list_4_expanded=!0;var l=this;this.restoreLocalSetting=function(t,e,i){try{if(localStorage){var a=localStorage.getItem(t);return null!==a?1==i?a.split("/"):a:e}}catch(n){}return e},this.limita=this.restoreLocalSetting("limita",10,!1),this.limitu=this.restoreLocalSetting("limitu",10,!1),this.limitp=this.restoreLocalSetting("limitp",10,!1),this.limito=this.restoreLocalSetting("limito",10,!1),this.limitc=this.restoreLocalSetting("limitc",10,!1),this.limitd=this.restoreLocalSetting("limitd",10,!1),t.lmtoggle="false"!=this.restoreLocalSetting("lmtoggle","false",!1),this.lastidEvent=0,this.userDepartments=[],this.userProductNames=[],this.departmentd=this.restoreLocalSetting("departmentd",[],!0),this.departmentdNames=[],this.operatord=this.restoreLocalSetting("operatord",[],!0),this.operatordNames=[],this.actived=this.restoreLocalSetting("actived",[],!0),this.actived_products=this.restoreLocalSetting("actived_products",[],!0),this.activedNames=[],this.unreadd=this.restoreLocalSetting("unreadd",[],!0),this.unreadd_products=this.restoreLocalSetting("unreadd_products",[],!0),this.unreaddNames=[],this.pendingd=this.restoreLocalSetting("pendingd",[],!0),this.pendingd_products=this.restoreLocalSetting("pendingd_products",[],!0),this.pendingdNames=[],this.closedd=this.restoreLocalSetting("closedd",[],!0),this.closedd_products=this.restoreLocalSetting("closedd_products",[],!0),this.closeddNames=[],this.widgetsItems=new Array,this.widgetsItems.push("actived"),this.widgetsItems.push("departmentd"),this.widgetsItems.push("unreadd"),this.widgetsItems.push("pendingd"),this.widgetsItems.push("operatord"),this.widgetsItems.push("closedd"),angular.forEach(this.widgetsItems,function(t){l[t+"_all_departments"]="false"!=l.restoreLocalSetting(t+"_all_departments","false",!1),l[t+"_hide_hidden"]="false"!=l.restoreLocalSetting(t+"_hide_hidden","false",!1),l[t+"_hide_disabled"]="false"!=l.restoreLocalSetting(t+"_hide_disabled","false",!1),l[t+"_only_online"]="false"!=l.restoreLocalSetting(t+"_only_online","false",!1),l[t+"_only_explicit_online"]="false"!=l.restoreLocalSetting(t+"_only_explicit_online","false",!1)}),this.storeLocalSetting=function(t,e){if(localStorage)try{var e=localStorage.setItem(t,e)}catch(i){}},this.removeLocalSetting=function(t){if(localStorage)try{localStorage.removeItem(t)}catch(e){}},this.toggleList=function(e){if(t[e]=!t[e],localStorage)try{localStorage.setItem(e,t[e])}catch(i){}},this.toggleWidgetData=[],this.toggleWidget=function(t){if(l.toggleWidgetData[t]="undefined"!=typeof l.toggleWidgetData[t]?!l.toggleWidgetData[t]:!0,localStorage)try{localStorage.setItem(t,l.toggleWidgetData[t])}catch(e){}},this.getToggleWidget=function(t){this.toggleWidgetData[t]="false"==this.restoreLocalSetting(t,"false",!1)?!1:!0},t.getSyncFilter=function(){var t="/(limita)/"+parseInt(l.limita);if(t+="/(limitu)/"+parseInt(l.limitu),t+="/(limitp)/"+parseInt(l.limitp),t+="/(limito)/"+parseInt(l.limito),t+="/(limitc)/"+parseInt(l.limitc),t+="/(limitd)/"+parseInt(l.limitd),"object"==typeof l.actived)if(l.actived.length>0)t+="/(actived)/"+l.actived.join("/");else{var e=l.manualFilterByFilter("actived");e.length>0&&(t+="/(actived)/"+e.join("/"))}if("object"==typeof l.unreadd)if(l.unreadd.length>0)t+="/(unreadd)/"+l.unreadd.join("/");else{var e=l.manualFilterByFilter("unreadd");e.length>0&&(t+="/(unreadd)/"+e.join("/"))}if("object"==typeof l.pendingd)if(l.pendingd.length>0)t+="/(pendingd)/"+l.pendingd.join("/");else{var e=l.manualFilterByFilter("pendingd");e.length>0&&(t+="/(pendingd)/"+e.join("/"))}if("object"==typeof l.operatord)if(l.operatord.length>0)t+="/(operatord)/"+l.operatord.join("/");else{var e=l.manualFilterByFilter("operatord");e.length>0&&(t+="/(operatord)/"+e.join("/"))}if("object"==typeof l.closedd&&l.closedd.length>0&&(t+="/(closedd)/"+l.closedd.join("/")),"object"==typeof l.departmentd)if(l.departmentd.length>0)t+="/(departmentd)/"+l.departmentd.join("/");else{var e=l.manualFilterByFilter("departmentd");e.length>0&&(t+="/(departmentd)/"+e.join("/"))}return"object"==typeof l.actived_products&&l.actived_products.length>0&&(t+="/(activedprod)/"+l.actived_products.join("/")),"object"==typeof l.unreadd_products&&l.unreadd_products.length>0&&(t+="/(unreaddprod)/"+l.unreadd_products.join("/")),"object"==typeof l.pendingd_products&&l.pendingd_products.length>0&&(t+="/(pendingdprod)/"+l.pendingd_products.join("/")),"object"==typeof l.closedd_products&&l.closedd_products.length>0&&(t+="/(closeddprod)/"+l.closedd_products.join("/")),t},t.$watch("lhc.limita",function(e,i){e!=i&&(l.storeLocalSetting("limita",e),t.loadChatList())}),this.manualFilterByFilter=function(t){if((1==l[t+"_only_explicit_online"]||1==l[t+"_hide_hidden"]||1==l[t+"_hide_disabled"]||1==l[t+"_only_online"])&&l.userDepartments.length>0){var e=[];return angular.forEach(l.userDepartments,function(i){(0==l[t+"_only_explicit_online"]||1==l[t+"_only_explicit_online"]&&1==i.oexp)&&(0==l[t+"_hide_hidden"]||1==l[t+"_hide_hidden"]&&0==i.hidden)&&(0==l[t+"_hide_disabled"]||1==l[t+"_hide_disabled"]&&0==i.disabled)&&(0==l[t+"_only_online"]||1==l[t+"_only_online"]&&1==i.ogen)&&e.push(i.id)}),0==e.length&&e.push(-1),e}return[]},this.setUpListNames=function(t){angular.forEach(t,function(t){l[t+"Names"]=[],angular.forEach(l[t],function(e){l[t+"Names"].push(l.userDepartmentsNames[e])})})},this.setDepartmentNames=function(t){l[t+"Names"]=[],angular.forEach(l[t],function(e){l[t+"Names"].push(l.userDepartmentsNames[e])})},this.departmentChanged=function(e){if(l[e].length>0){l[e+"_all_departments"]=!1,l.allDepartmentsChanged(e,!1);var i=l[e].join("/");""!=i&&(l.storeLocalSetting(e,i),l.setDepartmentNames(e))}else if(localStorage)try{localStorage.removeItem(e)}catch(a){}t.loadChatList()},this.productChanged=function(e){if(l[e].length>0){var i=l[e].join("/");""!=i&&l.storeLocalSetting(e,i)}else if(localStorage)try{localStorage.removeItem(e)}catch(a){}t.loadChatList()},this.allDepartmentsChanged=function(e,i){1==l[e+"_all_departments"]?l.storeLocalSetting(e+"_all_departments",!0):l.removeLocalSetting(e+"_all_departments"),1==l[e+"_hide_hidden"]?l.storeLocalSetting(e+"_hide_hidden",!0):l.removeLocalSetting(e+"_hide_hidden"),1==l[e+"_hide_disabled"]?l.storeLocalSetting(e+"_hide_disabled",!0):l.removeLocalSetting(e+"_hide_disabled"),1==l[e+"_only_online"]?l.storeLocalSetting(e+"_only_online",!0):l.removeLocalSetting(e+"_only_online"),1==l[e+"_all_departments"]?(l[e]=[],angular.forEach(l.userDepartments,function(t){(0==l[e+"_only_explicit_online"]||1==l[e+"_only_explicit_online"]&&1==t.oexp)&&(0==l[e+"_hide_hidden"]||1==l[e+"_hide_hidden"]&&0==t.hidden)&&(0==l[e+"_hide_disabled"]||1==l[e+"_hide_disabled"]&&0==t.disabled)&&(0==l[e+"_only_online"]||1==l[e+"_only_online"]&&1==t.ogen)&&l[e].push(t.id)}),0==l[e].length&&l[e].push(-1)):1==i&&(l[e]=[]),1==i&&t.loadChatList()},t.$watch("lhc.limitu",function(e,i){e!=i&&(l.storeLocalSetting("limitu",e),t.loadChatList())}),t.$watch("lhc.limitc",function(e,i){e!=i&&(l.storeLocalSetting("limitc",e),t.loadChatList())}),t.$watch("lhc.limitp",function(e,i){e!=i&&(l.storeLocalSetting("limitp",e),t.loadChatList())}),t.$watch("lhc.limito",function(e,i){e!=i&&(l.storeLocalSetting("limito",e),t.loadChatList())}),t.loadChatList=function(){if(localStorage)try{t.pending_chats_expanded="false"!=localStorage.getItem("pending_chats_expanded"),t.active_chats_expanded="false"!=localStorage.getItem("active_chats_expanded"),t.my_active_chats_expanded="false"!=localStorage.getItem("my_active_chats_expanded"),t.closed_chats_expanded="false"!=localStorage.getItem("closed_chats_expanded"),t.unread_chats_expanded="false"!=localStorage.getItem("unread_chats_expanded"),t.custom_list_1_expanded="false"!=localStorage.getItem("custom_list_1_expanded"),t.custom_list_2_expanded="false"!=localStorage.getItem("custom_list_2_expanded"),t.custom_list_3_expanded="false"!=localStorage.getItem("custom_list_3_expanded"),t.custom_list_4_expanded="false"!=localStorage.getItem("custom_list_4_expanded")}catch(e){}clearTimeout(t.timeoutControl),s.loadChatList(t.getSyncFilter()).then(function(e){var i=!1,a=0;angular.forEach(e.result,function(e,n){t[n]=e,e.last_id_identifier&&(void 0==lhinst.trackLastIDS[e.last_id_identifier]?lhinst.trackLastIDS[e.last_id_identifier]=parseInt(e.last_id):lhinst.trackLastIDS[e.last_id_identifier]<parseInt(e.last_id)?(lhinst.trackLastIDS[e.last_id_identifier]=parseInt(e.last_id),a!=lhinst.trackLastIDS[e.last_id_identifier]&&(a=lhinst.trackLastIDS[e.last_id_identifier],lhinst.playSoundNewAction(e.last_id_identifier,parseInt(e.last_id),e.nick?e.nick:"Live Help",e.msg?e.msg:confLH.transLation.new_chat),l.lastidEvent=parseInt(e.last_id))):lhinst.trackLastIDS[e.last_id_identifier]>parseInt(e.last_id)&&(lhinst.trackLastIDS[e.last_id_identifier]=parseInt(e.last_id)),0==e.last_id&&(lhinst.trackLastIDS[e.last_id_identifier]=0),parseInt(e.last_id)>0&&l.lastidEvent==e.last_id&&(i=!0))}),0==i&&lhinst.hideNotifications(),0==t.pending_chats.length&&clearTimeout(lhinst.soundIsPlaying),1==t.setTimeoutEnabled&&(t.timeoutControl=setTimeout(function(){t.loadChatList()},confLH.back_office_sinterval))},function(){t.timeoutControl=setTimeout(function(){t.loadChatList()},confLH.back_office_sinterval)})},this.previewChat=function(t){lhc.previewChat(t)},this.redirectContact=function(t,e){return lhinst.redirectContact(t,e)},this.startChatNewWindow=function(t,e){return lhinst.startChatNewWindow(t,e)},this.deleteChat=function(t,e,i){return lhinst.deleteChat(t,e,i)},this.startChat=function(t,e){return $("#tabs").size()>0?lhinst.startChat(t,$("#tabs"),s.truncate(e,10)):void lhinst.startChatNewWindow(t,e)},this.startChatNewWindowTransfer=function(t,e,i){return lhinst.startChatNewWindowTransfer(t,e,i)},this.startChatTransfer=function(t,e,i){return lhinst.startChatTransfer(t,$("#tabs"),e,i)},this.startChatOperator=function(t){window.open(WWW_DIR_JAVASCRIPT+"chat/startchatwithoperator/"+t,"operatorchatwindow-"+t,"menubar=1,resizable=1,width=780,height=450")},this.initLHCData=function(){s.loadInitialData().then(function(e){l.userDepartmentsNames=e.dp_names,l.userDepartments=e.dep_list,l.userProductNames=e.pr_names,angular.forEach(l.widgetsItems,function(t){l.setDepartmentNames(t)}),t.loadChatList()})},this.initLHCData()}]);